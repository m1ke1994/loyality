ГАЙД ДЛЯ ЗАКАЗЧИКА: КАК ПОЛЬЗОВАТЬСЯ СИСТЕМОЙ ЛОЯЛЬНОСТИ

1) ОБЗОР СИСТЕМЫ
Платформа лояльности разделена по организациям (тенантам). Данные одной организации не смешиваются с другой.
В системе есть 4 входа:
- Клиент
- Продавец (кассир)
- Админ организации
- Платформенный superadmin (Django Admin)

Каждая организация имеет свой уникальный slug и ссылку формата:
http://localhost:5173/t/{tenant_slug}/

2) РОЛИ И ИХ ВОЗМОЖНОСТИ

2.1 Клиент
- Регистрируется только по ссылке своей организации.
- Получает личный кабинет, видит баланс и историю операций.
- Может получить QR-код для начисления/списания.

2.2 Кассир
- Входит по ссылке своей организации.
- Проверяет QR клиента, начисляет/списывает баллы.
- Видит операции только своей организации.

2.3 Админ организации
- Входит по ссылке своей организации.
- Видит клиентов, кассиров, операции, локации, правила, предложения.
- Создает кассиров и админов своей организации.

2.4 Платформенный админ (Django Admin)
- Входит в Django Admin: http://localhost:8000/admin/
- Может видеть все организации и все данные.
- Создает новые организации и управляет глобально.

3) СОЗДАНИЕ ОРГАНИЗАЦИИ (ТЕНАНТА)

Делается через Django Admin:
1) Открыть: http://localhost:8000/admin/
2) Войти под superuser.
3) Раздел "Tenants" (Организации/Арендаторы).
4) Нажать "Добавить".
5) Заполнить:
   - slug: короткий уникальный идентификатор (например: org1)
   - name: название организации (например: "Организация 1")
   - pos_api_key: можно оставить пустым
6) Сохранить.

После создания, ссылка организации:
http://localhost:5173/t/org1/

4) ТОЧКИ ВХОДА ПО ОРГАНИЗАЦИИ

Для организации org1:
- Клиент логин: http://localhost:5173/t/org1/login
- Клиент регистрация: http://localhost:5173/t/org1/register
- Кассир логин: http://localhost:5173/t/org1/cashier/login
- Админ организации логин: http://localhost:5173/t/org1/admin/login

5) РЕГИСТРАЦИЯ И ВЕРИФИКАЦИЯ КЛИЕНТА

1) Клиент открывает регистрацию:
   http://localhost:5173/t/{tenant_slug}/register
2) Вводит email и пароль.
3) На email приходит код подтверждения (в dev-режиме код выводится в консоль).
4) После подтверждения email клиент получает доступ к кабинету.

6) СОЗДАНИЕ АДМИНА/КАССИРА ОРГАНИЗАЦИИ

Способ 1: Через админ-панель организации (рекомендуется)
1) Войти как админ организации:
   http://localhost:5173/t/{tenant_slug}/admin/login
2) Раздел "Сотрудники".
3) Создать пользователя с ролью ADMIN или CASHIER.
   Важно: email подтвержден автоматически.

Способ 2: Через Django Admin (для superadmin)
1) Войти: http://localhost:8000/admin/
2) Раздел Users.
3) Создать пользователя:
   - tenant: нужная организация
   - role: ADMIN или CASHIER
   - email_verified: True
   - is_active: True
4) При необходимости создать StaffProfile для пользователя.

7) ПРОВЕРКА РАБОТЫ И ИЗОЛЯЦИИ ДАННЫХ

1) Создать две организации: org1 и org2.
2) Зарегистрировать клиента в org1 и клиента в org2.
3) Войти в админ-панель org1:
   http://localhost:5173/t/org1/admin/login
4) Убедиться, что видны только пользователи/операции org1.
5) Войти в админ-панель org2 и проверить аналогично.

8) ВИДЖЕТ

Виджет запускается в контексте организации:
http://localhost:5173/t/{tenant_slug}/widget

Он всегда создает клиентов только внутри своей организации.

9) ЧАСТЫЕ ПРОБЛЕМЫ

1) EMAIL_NOT_VERIFIED
Причина: у пользователя не подтвержден email.
Решение: подтвердить email кодом или выставить email_verified = True в Django Admin.

2) 401 при логине
Причина: неверный email/пароль или логин не в своей организации.
Решение: проверить tenant_slug и учетные данные.

3) 400 при создании кассира
Причина: email уже существует или неверная локация.
Решение: проверить Response JSON, особенно EMAIL_EXISTS или LOCATION_NOT_FOUND.

10) КРАТКИЙ ЧЕКЛИСТ ДЛЯ ЗАПУСКА

- Создать Tenant в Django Admin
- Получить ссылку /t/{slug}/
- Зарегистрировать клиента по ссылке
- Создать администратора и кассира организации
- Проверить операции и изоляцию данных
